---
title: "[ìŠ¤í”„ë§ ì…ë¬¸] ì„¹ì…˜3. íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ"
published: false
excerpt: "ìŠ¤í”„ë§ ì…ë¬¸ - ê¹€ì˜í•œ ë‹˜ì˜ ê°•ì˜ ë‚´ìš©ì…ë‹ˆë‹¤."
toc: true
toc_sticky: true
categories:
  - Spring
tags:
  - Backend
  - Java
  - ê¹€ì˜í•œ
last_modified_at: 2021-05-30 14:00:00
---

# ì„¹ì…˜3. íšŒì› ê´€ë¦¬ ì˜ˆì œ

<span style="color:grey">[ìŠ¤í”„ë§ ì…ë¬¸ - ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸, ì›¹ MVC, DB ì ‘ê·¼ ê¸°ìˆ ] ë‚´ìš©ì…ë‹ˆë‹¤.</span>  

## 3.1. ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬
  
- ë°ì´í„° : íšŒì› ID, ì´ë¦„  
- ê¸°ëŠ¥ : íšŒì› ë“±ë¡, ì¡°íšŒ  
- ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•ŠìŒ(ê°€ìƒ ì‹œë‚˜ë¦¬ì˜¤)  
  
### ì¼ë°˜ì ì¸ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°
![ì´ë¯¸ì§€](/assets/images/Spring/ìŠ¤í”„ë§ì…ë¬¸/ì„¹ì…˜3/1.png)
- ì»¨íŠ¸ë¡¤ëŸ¬ : ì›¹ MVCì˜ **ì»¨íŠ¸ë¡¤ëŸ¬** ì—­í•   
- ì„œë¹„ìŠ¤ : ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´ë¥¼ ì´ìš©í•´ì„œ **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„**  
  ex) íšŒì›ì€ ì¤‘ë³µ ê°€ì…ë˜ì§€ ì•ŠëŠ”ë‹¤.  
- ë¦¬í¬ì§€í† ë¦¬ : ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬  
- ë„ë©”ì¸ : ì£¼ë¡œ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬ë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´, ì˜ˆ) íšŒì›, ì£¼ë¬¸, ì¿ í° ë“±ë“±  
  
### í´ë˜ìŠ¤ ì˜ì¡´ê´€ê³„
![ì´ë¯¸ì§€](/assets/images/Spring/ìŠ¤í”„ë§ì…ë¬¸/ì„¹ì…˜3/2.png)
- ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•Šê³ , RDB, NoSQL ë“±ë“± ë‹¤ì–‘í•œ ì €ì¥ì†Œë¥¼ ê³ ë¯¼ì¤‘ì¸ ìƒí™©ìœ¼ë¡œ ê°€ì •  
- êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ì¸í„°í˜ì´ìŠ¤(Interface)ë¡œ ì„¤ê³„   
- ì´ˆê¸° ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” ë©”ëª¨ë¦¬ í˜„ì²´ë¡œ <u>ê°€ë²¼ìš´ ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ ë°ì´í„° ì €ì¥ì†Œ</u> ì‚¬ìš©  

## 3.2. íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°
    
### íšŒì›ê°ì²´  
  
ë¨¼ì € MemberëŠ” `idì‹ë³„ì`ì™€ `name`ì„ ê°–ëŠ”ë‹¤.  
  
```java
package hello.hellospring.domain;
  
public class Member {
  
    private Long id;
    private String name;

    public Long getId() {
          return id;
    }

    public void setId(Long id) {
          this.id = id;
    }
           public String getName() {
          return name;
    }
      public void setName(String name) {
          this.name = name;
    } 
}
```
  
  
### íšŒì› ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤  
  
```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.List;
import java.util.Optional;

public interface MemberRepository {

      Member save(Member member);
      Optional<Member> findById(Long id);
      Optional<Member> findByName(String name);
      List<Member> findAll();

}
```
  
> **Optional<>**
> "ì¡´ì¬í•  ìˆ˜ë„ ìˆì§€ë§Œ ì•ˆ í•  ìˆ˜ë„ ìˆëŠ” ê°ì²´"ë¥¼ ê°ì‹¸ëŠ” ì¼ì¢…ì˜ Wrapperí´ë˜ìŠ¤  
> ìì„¸í•œ ë‚´ìš©ì€ ë” ìë°”8 ê°•ì˜ ë‚´ìš©ì„ ì°¸ê³ í•˜ì.  
> ì—¬ê¸°ì„œëŠ” `findById` í˜¹ì€ `findByName`ì—ì„œ Nullì„ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ì˜€ë‹¤.  
  
### íšŒì› ë¦¬í¬ì§€í† ë¦¬ ë©”ëª¨ë¦¬ êµ¬í˜„ì²´

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.*;
 /**
* ë™ì‹œì„± ë¬¸ì œê°€ ê³ ë ¤ë˜ì–´ ìˆì§€ ì•ŠìŒ, ì‹¤ë¬´ì—ì„œëŠ” ConcurrentHashMap, AtomicLong ì‚¬ìš© ê³ ë ¤
*/
public class MemoryMemberRepository implements MemberRepository {
    private static Map<Long, Member> store = new HashMap<>();
    private static long sequence = 0L; //0,1,2ì™€ ê°™ì€ keyê°’ì„ ìƒì„±í•´ì£¼ê¸° ìœ„í•¨.
    
    @Override
    public Member save(Member member) {
        member.setId(++sequence); // memberë¥¼ ì„¸ì´ë¸Œ í•  ë•Œë§ˆë‹¤ 1ì”© ì¦ê°€ì‹œì¼œì¤Œ.
        store.put(member.getId(), member);
        return member;
    }
    
    @Override
    public Optional<Member> findById(Long id) {
        return Optional.ofNullable(store.get(id));
    }
    
    @Override
    public List<Member> findAll() {
        return new ArrayList<>(store.values());
    }
    
    @Override
    public Optional<Member> findByName(String name) {
        return store.values().stream()
                .filter(member -> member.getName().equals(name))
                .findAny(); // ì¼ì¹˜í•˜ëŠ” ê²ƒ í•˜ë‚˜ë¼ë„ ì°¾ëŠ”ë‹¤. 
    }
    
    public void clearStore() {
        store.clear();
    } 
}
```
  
## 3.3. íšŒì› ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±
ê°œë°œí•œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸ í•  ë•Œ main ë©”ì„œë“œë‚˜, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ í•´ë‹¹ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ë©´,  
1. ì¤€ë¹„ì™€ ì‹¤í–‰ì´ ì˜¤ë˜ ê±¸ë¦¬ê³ ,  
2. ë°˜ë³µ ì‹¤í–‰í•˜ê¸° ì–´ë µê³ ,  
3. ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ í•œë²ˆì— ì‹¤í–‰í•˜ê¸° ì–´ë µë‹¤  
ëŠ” ë‹¨ì ì´ ìˆë‹¤.  
  
ìë°”ëŠ” **JUnit** ì´ë¼ëŠ” í”„ë ˆì„ì›Œí¬ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ì„œ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.  
  
JUnitì„ ì‚¬ìš©í•˜ë©´..
1. êµ¬í˜„í•œ ê¸°ëŠ¥ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.  
2. í´ë˜ìŠ¤ ë ˆë²¨ ë‹¨ìœ„ë¡œë„ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.  
  
### íšŒì› ë¦¬í¬ì§€í† ë¦¬ ë©”ëª¨ë¦¬ êµ¬í˜„ì²´ í…ŒìŠ¤íŠ¸
  
```java
package Hello.Hellospring2.repository;

import Hello.Hellospring2.domain.Member;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Test;

import java.util.List;

import static org.assertj.core.api.AssertionsForClassTypes.assertThat;

public class MemoryMemberRepositoryTest {

    MemoryMemberRepository repository = new MemoryMemberRepository();

    @AfterEach // í…ŒìŠ¤íŠ¸ë¥¼ ëë‚ ë•Œ ë§ˆë‹¤. ë¦¬í¬ì§“í† ë¦¬ë¥¼ ê¹”ê¼¼í•˜ê²Œ ì§€ì›Œì£¼ê¸° ìœ„í•¨
    public void afterEach() {
        repository.clearStore();
    }

    // ì•ì— @Testë¥¼ ë¶™í˜€ì¤€ë‹¤.
    @Test
    public void save() {
        //given
        Member member = new Member();
        member.setName("spring");

        //when
        repository.save(member);

        //then
        Member result = repository.findById(member.getId()).get();
        //System.out.println("result = " + (result == member)); ì´ê±° ëŒ€ì‹ ì— ë°‘ì— ë‘ê°œë¡œ ì”€

        //Assertions.assertEquals(member, result); // ì¶œë ¥ë˜ëŠ” ê±´ ì—†ì§€ë§Œ ì´ˆë¡ë¶ˆì´ ëœ¸
        //import í•´ë†“ìœ¼ë©´ Assertions. ìƒëµ ê°€ëŠ¥í•¨.
        assertThat(member).isEqualTo(result);
    }

    @Test
    public void findByName() {

        //given
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        //when
        Member result = repository.findByName("spring1").get();

        //then
        assertThat(result).isEqualTo(member1);
    }

    @Test
    public void findAll() {

        //given
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        //when
        List<Member> result = repository.findAll();

        //then
        assertThat(result.size()).isEqualTo(2);
    }
}

```
  
> **í…ŒìŠ¤íŠ¸ ê²°ê³¼ì— ëŒ€í•œ ê²€ì¦ë°©ë²•**  
> ê°€ì¥ ë§ì´ ì“°ì´ëŠ” ë°©ë²•ì€  
> 1. println( )  
> 2. assertEquals(a,b)  
> 3. assertThat(a).isEqualTo(b)  
  
## 3.4. íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
  
íšŒì› ì„œë¹„ìŠ¤ëŠ” íšŒì› ë¦¬í¬ì§€í† ë¦¬ì™€ ë„ë©”ì¸ì„ í†µí•´ì„œ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ëŠ” ê³³  
ì„œë¹„ìŠ¤ì˜ í´ë˜ìŠ¤ëª…ì€ ì£¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ì™€ ë§¤ì¹­ë˜ë„ë¡ ì‘ëª…ì„ í•œë‹¤.  
  
```java
package Hello.Hellospring2.service;

import Hello.Hellospring2.domain.Member;
import Hello.Hellospring2.repository.MemberRepository;
import Hello.Hellospring2.repository.MemoryMemberRepository;

import java.util.List;
import java.util.Optional;

public class MemberService {
    private final MemberRepository memberRepository;

    // ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ë ¤ë©´ ë¦¬í¬ì§€í† ë¦¬ê°€ ìˆì–´ì•¼ í•¨.
    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    /**
     * íšŒì›ê°€ì…
     */

    // íšŒì› ê°€ì…ë¶€í„° ë§Œë“¤ë©´
    public Long join(Member member) {
        // ê°™ì€ ì´ë¦„ì¸ ì¤‘ë³µ íšŒì› ê°€ì… ë°©ì§€ ì‘ì„±

        // memberRepository.findByName(member.getName())
        // .ifPresent(m -> {
        //  throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        //  });

        // ìœ„ì™€ ê°™ì´ ì­ˆìš°ìš± ë‚˜ì˜¤ëŠ”ë°, ì´ëŸ´ê²½ìš° ì•„ë˜ì²˜ëŸ¼ methodë¡œ ë”°ë¡œ ë½‘ëŠ”ê²Œ ì¢‹ë‹¤.
        // ë‹¨ì¶•í‚¤ëŠ” control + T í•œ ë‹¤ìŒì— [Extract Method]ë¥¼ í•˜ë©´ ëœë‹¤. 
        validateDuplicateMember(member); //ì¤‘ë³µ íšŒì› ê²€ì¦

        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        memberRepository.findByName(member.getName())
            .ifPresent(m -> {
                throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
                });
    }

    /**
     *ì „ì²´ íšŒì› ì¡°íšŒ
     */

    public List<Member> findMembers() {
        return memberRepository.findAll();
    }

    public Optional<Member> findOne(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```
  
## 3.5. íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
  
í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ì‰½ê²Œ ë§Œë“œëŠ” ë°©ë²•ì€ [command + shift + T]ë¥¼ ëˆ„ë¥´ê³  [create new test]í•˜ì.  
ì¶”ê°€ íŒì„ ì£¼ìë©´ í…ŒìŠ¤íŠ¸ì˜ Method ëª…ì€ í•œê¸€ë¡œ ì ì–´ë„ ë¬´ë°©í•˜ë‹¤.  

```java
package Hello.Hellospring2.service;

import Hello.Hellospring2.domain.Member;
import Hello.Hellospring2.repository.MemoryMemberRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

class MemberServiceTest {

    MemberService memberService;
    MemoryMemberRepository memberRepository;

    @BeforeEach
    public void beforeEach(){
        memberRepository = new MemoryMemberRepository();
        memberService = new MemberService(memberRepository); //D.I
    }

    @AfterEach
    public void afterEach(){
        memberRepository.clearStore();
    }

    @Test
    public void íšŒì›ê°€ì…() {
        //Given : ë¬´ì–¸ê°€ ì£¼ì–´ì§€ê³ 
        Member member = new Member();
        member.setName("hello");

        //When : ì´ê²ƒì„ ì‹¤í–‰í–ˆì„ ë•Œ
        Long saveId = memberService.join(member);

        //Then : ì´ëŸ¬í•œ ê²°ê³¼ê°€ ë‚˜ì™€ì•¼í•œë‹¤. 
        Member findMember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findMember.getName());
    }
    @Test
    public void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() throws Exception {
        //Given
        Member member1 = new Member();
        member1.setName("spring");
        Member member2 = new Member();
        member2.setName("spring");

        //When
        memberService.join(member1);

        /* ì´ë ‡ê²Œ try ~ catchë¥¼ ì¨ë„ ë˜ê¸´ í•˜ì§€ë§Œ..
            try {
                memberService.join(member2);
                fail();
            }catch (IllegalStateException e){
                assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
            }
        */

        // ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•˜ê²Œ ì“°ë„ë¡ í•˜ì.
        IllegalStateException e = assertThrows(IllegalStateException.class,() -> memberService.join(member2));//ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.
        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }
}
```
  
> `@BeforeEach`  
> ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì „ì— í˜¸ì¶œë˜ì–´ <u>í•­ìƒ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±</u>í•˜ê³ ,  
> <u>ì˜ì¡´ê´€ê³„ë¥¼ ìƒˆë¡œ ë§ºì–´ì¤€ë‹¤.</u>  
> â¡ï¸ í…ŒìŠ¤íŠ¸ë¼ë¦¬ì˜ ë…ë¦½ì„± ë³´ì¥  
  
### Dependency Injection
  
**í•˜ë‚˜ì˜ ê°ì²´ê°€ ë‹¤ë¥¸ ê°ì²´ì˜ ì˜ì¡´ì„±ì„ ì œê³µí•˜ëŠ” í…Œí¬ë‹‰**
  
ì•„ë˜ì˜ ì½”ë“œì—ì„œ MemberServiceì˜ ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•˜ì§€ ì•Šê³ ,  
ì™¸ë¶€ì—ì„œ ê°’ì„ ë„£ì–´ì£¼ë„ë¡ ì½”ë“œê°€ êµ¬ì„±ë˜ì–´ ìˆë‹¤.  
  
ê·¸ ì´ìœ ëŠ” ê°ê°ì˜ í´ë˜ìŠ¤ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ repositoryë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•˜ë©´,  
ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.  
  
ë”°ë¼ì„œ, ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±ë˜ì—ˆë‹¤.  
ì´ë¥¼ í†µí•´ ê°€ë…ì„±ê³¼ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì—¬ì¤„ ìˆ˜ ìˆë‹¤.ğŸ‘ğŸ»  
  
`MemberService.java`
  
```java
public class MemberService {
    private final MemberRepository memberRepository;

    //ì§ì ‘ newë¡œ ìƒì„±í•˜ì§€ ì•Šê³ , ì™¸ë¶€ì—ì„œ ë„£ì–´ì£¼ë„ë¡ -> dependency injection
    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
	...
}
```
  
`MemberServiceTest.java`
  
```java
class MemberServiceTest {

    MemberService memberService;
    MemoryMemberRepository memberRepository;

    @BeforeEach
    public void beforeEach() {
        memberRepository = new MemoryMemberRepository();
        memberService = new MemberService(memberRepository);
    }
	...
}
```
  
ë-!